trigger:
- master

pool:
  name: Default

steps:
- checkout: self
  clean: true

- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '8.x'

- task: DotNetCoreCLI@2
  displayName: Restore
  inputs:
    command: restore
    projects: '**/WebAppAutomation.csproj'

- task: DotNetCoreCLI@2
  displayName: Build
  inputs:
    command: build
    projects: '**/WebAppAutomation.csproj'
    arguments: '--configuration Release'

- task: DotNetCoreCLI@2
  displayName: Test
  inputs:
    command: test
    projects: '**/WebAppAutomation.csproj'
    arguments: '--configuration Release --settings "$(Build.SourcesDirectory)/QAS.runsettings" --logger trx --results-directory "$(Pipeline.Workspace)/TestResults"'
    # Note: I recommend removing 'publishTestResults: true' here as we'll use the dedicated task
    # publishTestResults: true 

- task: PublishTestResults@2
  displayName: Publish Test Results
  inputs:
    # The default output format for dotnet test is 'VSTest' which uses .trx files.
    testResultsFormat: 'VSTest'
    
    # Path to search for .trx files. This matches the directory specified above.
    testResultsFiles: '$(Pipeline.Workspace)/TestResults/**/*.trx'
    
    # Optional: Gives the test run a custom title for clarity
    testRunTitle: '$(Build.DefinitionName) - Automated UI Tests'
    
    # Optional: If you want to attach the results to the build itself
    failTaskOnFailedTests: true